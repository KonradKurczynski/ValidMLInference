# `ols`

Ordinary Least Squares (OLS) regression with support for both formula-style and array-based interfaces. This function provides a unified interface for fitting linear models using either patsy formulas with pandas DataFrames or raw NumPy arrays.

**Usage Options**
----------
**Option 1: Formula Interface**

- **`formula`** (`str`)\
A patsy-style formula string (e.g., `y ~ x1 + x2`).
- **`data`** (`pd.DataFrame`)\
A DataFrame containing the variables referenced in the formula.

**Option 2: Array Interface**  
- **`Y`** (`array_like`, shape `(n,)`)\
Response variable vector.
- **`X`** (`array_like`, shape `(n, d)`)\
Design matrix of covariates.

**Additional Parameters**
----------

- **`se`** (`bool`, optional, default: `True`)\
Whether to compute standard errors using heteroskedastic-consistent estimator.
- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`names`** (`list[str]`, optional)\
Variable names. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
An object containing the following attributes:
    - `.coef` &mdash; coefficient estimates
    - `.vcov` &mdash; variance-covariance matrix
    - `.names` &mdash; variable names

---

# `ols_bca`

Performs an additive bias correction to regressions that include a binary covariate generated by AI/ML. This method requires an external estimate of the false-positive rate. Standard errors are adjusted to account for uncertainty in the false-positive rate estimate.

**Usage Options**
----------
**Option 1: Formula Interface**

- **`formula`** (`str`)\
A patsy-style formula string.
- **`data`** (`pd.DataFrame`)\
DataFrame containing the variables referenced in the formula.

**Option 2: Array Interface**  
- **`Y`** (`array_like`, shape `(n,)`)\
Response variable vector.
- **`Xhat`** (`array_like`, shape `(n, d)`)\
Design matrix of covariates.

**Additional Parameters**
----------

- **`fpr`** (`float`)\
Estimated false positive rate of misclassification, used to correct the OLS estimates.
- **`m`** (`int`)\
Size of the external sample used to estimate the classifier's false-positive rate. Can be set to a large number when the false-positive rate is known exactly.
- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`generated_var`** (`str`, optional)\
Name of the treatment variable to apply bias correction to. If not specified, defaults to the first non-intercept variable.
- **`names`** (`list[str]`, optional)\
Variable names for the coefficients. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
Object containing bias-corrected coefficient estimates (`.coef`), adjusted variance-covariance matrix (`.vcov`), and variable names (`.names`).

---

# `ols_bcm`

Performs a multiplicative bias correction to regressions that include a binary covariate generated by AI/ML. This method requires an external estimate of the false-positive rate. Standard errors are adjusted to account for uncertainty in the false-positive rate estimate.

**Usage Options**
----------
**Option 1: Formula Interface**

- **`formula`** (`str`)\
A patsy-style formula string.
- **`data`** (`pd.DataFrame`)\
DataFrame containing the variables referenced in the formula.

**Option 2: Array Interface**  
- **`Y`** (`array_like`, shape `(n,)`)\
Response variable vector.
- **`Xhat`** (`array_like`, shape `(n, d)`)\
Design matrix of covariates.

**Additional Parameters**
----------

- **`fpr`** (`float`)\
Estimated false positive rate of misclassification, used to correct the OLS estimates.
- **`m`** (`int`)\
Size of the external sample used to estimate the classifier's false-positive rate. Can be set to a large number when the false-positive rate is known exactly.
- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`generated_variable`** (`str`, optional)\
Name of the treatment variable to apply bias correction to. If not specified, defaults to the first non-intercept variable.
- **`names`** (`list[str]`, optional)\
Variable names for the coefficients. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
Object containing bias-corrected coefficient estimates (`.coef`), adjusted variance-covariance matrix (`.vcov`), and variable names (`.names`).

---

# `one_step`

Maximum likelihood estimation of the regression model, treating the generated covariate as a noisy proxy for the true latent variable. This method is particularly useful when an estimate of the false positive rate is not available. The variance of the estimates is approximated via the inverse Hessian at the optimum.

**Usage Options**
----------
**Option 1: Formula Interface**

- **`formula`** (`str`)\
A patsy-style formula string.
- **`data`** (`pd.DataFrame`)\
DataFrame containing the variables referenced in the formula.

**Option 2: Array Interface**  
- **`Y`** (`array_like`, shape `(n,)`)\
Response variable vector.
- **`Xhat`** (`array_like`, shape `(n, d)`)\
Design matrix of covariates.

**Additional Parameters**
----------

- **`generated_var`** (`str`, optional)\
Name of the binary treatment variable. If not specified, defaults to the first non-intercept variable.
- **`homoskedastic`** (`bool`, optional, default: `False`)\
If True, assumes a common error variance; otherwise, the error variance is allowed to vary with the true latent binary variable.
- **`distribution`** (`callable`, optional)\
Custom distribution for error terms. Must be a JAX-compatible PDF function with signature (x, loc, scale). Defaults to Normal(0,1).
- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`names`** (`list[str]`, optional)\
Variable names for the coefficients. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
Object containing estimated regression coefficients (`.coef`), variance-covariance matrix (`.vcov`), and variable names (`.names`).

---

# `one_step_gaussian_mixture`

Maximum likelihood estimation of the regression model, treating the generated covariate as a noisy proxy for the true latent variable and using a Gaussian mixture model for error terms. This provides greater flexible then `one_step` for settings with more complex error structures.

**Usage Options**
----------
**Option 1: Formula Interface**

- **`formula`** (`str`)\
A patsy-style formula string.
- **`data`** (`pd.DataFrame`)\
DataFrame containing the variables referenced in the formula.

**Option 2: Array Interface**  
- **`Y`** (`array_like`, shape `(n,)`)\
Response variable vector.
- **`Xhat`** (`array_like`, shape `(n, d)`)\
Design matrix of covariates.

**Additional Parameters**
----------

- **`generated_var`** (`str`, optional)\
Name of the binary treatment variable. If not specified, defaults to the first variable.
- **`k`** (`int`, optional, default: `2`)\
Number of components in the Gaussian mixture model.
- **`homosked`** (`bool`, optional, default: `False`)\
If True, assumes a common error variance; otherwise, the error variance is allowed to vary with the true latent binary variable.
- **`nguess`** (`int`, optional, default: `10`)\
Number of random restarts for optimization to avoid local minima.
- **`maxiter`** (`int`, optional, default: `100`)\
Maximum number of optimization iterations.
- **`seed`** (`int`, optional, default: `0`)\
Random seed for reproducible results.
- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`names`** (`list[str]`, optional)\
Variable names for the coefficients. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
Object containing estimated regression coefficients (`.coef`), variance-covariance matrix (`.vcov`), and variable names (`.names`).

---

# `ols_bca_topic`

Bias-corrected additive estimator for topic model regression. This method applies additive bias correction to regressions that include topic proportions as covariates, accounting for estimation uncertainty in the topic model.

**Required Parameters**
----------

- **`Y`** (`np.ndarray`)\
Outcome variable vector.
- **`Q`** (`np.ndarray`)\
Covariates matrix (excluding topic proportions).
- **`W`** (`np.ndarray`)\
Document-topic distribution matrix from the topic model.
- **`S`** (`np.ndarray`)\
Topic-vocabulary matrix from the topic model.
- **`B`** (`np.ndarray`)\
Vocabulary matrix from the topic model.
- **`k`** (`float`)\
Bias correction parameter.

**Additional Parameters**
----------

- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`names`** (`list[str]`, optional)\
Variable names for the coefficients. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
Object containing bias-corrected coefficient estimates (`.coef`), adjusted variance-covariance matrix (`.vcov`), and variable names (`.names`).

---

# `ols_bcm_topic`

Bias-corrected multiplicative estimator for topic model regression. This method applies multiplicative bias correction to regressions that include topic proportions as covariates, accounting for estimation uncertainty in the topic model.

**Required Parameters**
----------

- **`Y`** (`np.ndarray`)\
Outcome variable vector.
- **`Q`** (`np.ndarray`)\
Covariates matrix (excluding topic proportions).
- **`W`** (`np.ndarray`)\
Document-topic distribution matrix from the topic model.
- **`S`** (`np.ndarray`)\
Topic-vocabulary matrix from the topic model.
- **`B`** (`np.ndarray`)\
Vocabulary matrix from the topic model.
- **`k`** (`float`)\
Bias correction parameter.

**Additional Parameters**
----------

- **`intercept`** (`bool`, optional, default: `True`)\
Whether to include an intercept term in the model.
- **`names`** (`list[str]`, optional)\
Variable names for the coefficients. If not provided, default names are generated.

**Returns**
-------
- **`result`** (`RegressionResult`)\
Object containing bias-corrected coefficient estimates (`.coef`), adjusted variance-covariance matrix (`.vcov`), and variable names (`.names`).

---

# `remote_work_data`

Loads the built-in remote work dataset for demonstration and testing purposes.

**Returns**
-------
- **`data`** (`pd.DataFrame`)\
DataFrame containing the remote work dataset with variables for analysis.

# `topic_model_data`

Loads the built-in topic model dataset for demonstration and testing purposes.

**Returns**
-------
- **`data`** (`pd.DataFrame`)\
DataFrame containing the remote work dataset with variables for analysis.
